{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="max-w-6xl mx-auto py-10 px-4">
  <h2 class="text-2xl font-semibold mb-6">Listed Properties</h2>

  <form method="get" class="mb-6 bg-white p-4 rounded shadow space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

      <div>
        <label for="postal_code" class="block text-sm font-medium text-gray-700">Postal Code</label>
        <input type="text" name="postal_code" id="postal_code" value="{{ request.GET.postal_code }}" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
      </div>

      <div>
        <label for="price_min" class="block text-sm font-medium text-gray-700">Min Price</label>
        <select name="price_min" id="price_min" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          <option value="">Any</option>
          <option value="1000000" {% if request.GET.price_min == '1000000' %}selected{% endif %}>1,000,000 ISK</option>
          <option value="5000000" {% if request.GET.price_min == '5000000' %}selected{% endif %}>5,000,000 ISK</option>
          <option value="10000000" {% if request.GET.price_min == '10000000' %}selected{% endif %}>10,000,000 ISK</option>
          <option value="20000000" {% if request.GET.price_min == '20000000' %}selected{% endif %}>20,000,000 ISK</option>
          <option value="30000000" {% if request.GET.price_min == '30000000' %}selected{% endif %}>30,000,000 ISK</option>
          <option value="40000000" {% if request.GET.price_min == '40000000' %}selected{% endif %}>40,000,000 ISK</option>
          <option value="50000000" {% if request.GET.price_min == '50000000' %}selected{% endif %}>50,000,000 ISK</option>
          <option value="60000000" {% if request.GET.price_min == '60000000' %}selected{% endif %}>60,000,000 ISK</option>
          <option value="70000000" {% if request.GET.price_min == '70000000' %}selected{% endif %}>70,000,000 ISK</option>
          <option value="80000000" {% if request.GET.price_min == '80000000' %}selected{% endif %}>80,000,000 ISK</option>
          <option value="90000000" {% if request.GET.price_min == '90000000' %}selected{% endif %}>90,000,000 ISK</option>
          <option value="100000000" {% if request.GET.price_min == '100000000' %}selected{% endif %}>100,000,000 ISK</option>
        </select>
      </div>

      <div>
        <label for="price_max" class="block text-sm font-medium text-gray-700">Max Price</label>
        <select name="price_max" id="price_max" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          <option value="">Any</option>
          <option value="1000000" {% if request.GET.price_min == '1000000' %}selected{% endif %}>1,000,000 ISK</option>
          <option value="5000000" {% if request.GET.price_min == '5000000' %}selected{% endif %}>5,000,000 ISK</option>
          <option value="10000000" {% if request.GET.price_min == '10000000' %}selected{% endif %}>10,000,000 ISK</option>
          <option value="20000000" {% if request.GET.price_min == '20000000' %}selected{% endif %}>20,000,000 ISK</option>
          <option value="30000000" {% if request.GET.price_min == '30000000' %}selected{% endif %}>30,000,000 ISK</option>
          <option value="40000000" {% if request.GET.price_min == '40000000' %}selected{% endif %}>40,000,000 ISK</option>
          <option value="50000000" {% if request.GET.price_min == '50000000' %}selected{% endif %}>50,000,000 ISK</option>
          <option value="60000000" {% if request.GET.price_min == '60000000' %}selected{% endif %}>60,000,000 ISK</option>
          <option value="70000000" {% if request.GET.price_min == '70000000' %}selected{% endif %}>70,000,000 ISK</option>
          <option value="80000000" {% if request.GET.price_min == '80000000' %}selected{% endif %}>80,000,000 ISK</option>
          <option value="90000000" {% if request.GET.price_min == '90000000' %}selected{% endif %}>90,000,000 ISK</option>
          <option value="100000000" {% if request.GET.price_min == '100000000' %}selected{% endif %}>100,000,000 ISK</option>
          <option value="150000000" {% if request.GET.price_min == '150000000' %}selected{% endif %}>150,000,000 ISK</option>
          <option value="200000000" {% if request.GET.price_min == '200000000' %}selected{% endif %}>200,000,000 ISK</option>
          <option value="300000000" {% if request.GET.price_min == '300000000' %}selected{% endif %}>300,000,000 ISK</option>
        </select>
      </div>

      <div>
        <label for="property_type" class="block text-sm font-medium text-gray-700">Type</label>
        <select name="property_type" id="property_type" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          <option value="">Any</option>
          <option value="villa" {% if request.GET.property_type == 'villa' %}selected{% endif %}>Villa</option>
          <option value="house" {% if request.GET.property_type == 'house' %}selected{% endif %}>House</option>
          <option value="townhouse" {% if request.GET.property_type == 'townhouse' %}selected{% endif %}>Townhouse</option>
          <option value="apartment" {% if request.GET.property_type == 'apartment' %}selected{% endif %}>Apartment</option>
        </select>
      </div>

      <div>
        <label for="search" class="block text-sm font-medium text-gray-700">Search</label>
        <input type="text" name="search" id="search" value="{{ request.GET.search }}" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
      </div>

      <div>
        <label for="order_by" class="block text-sm font-medium text-gray-700">Order By</label>
        <select name="order_by" id="order_by" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          <option value="listing_price" {% if request.GET.order_by == 'listing_price' %}selected{% endif %}>Price</option>
          <option value="street" {% if request.GET.order_by == 'street' %}selected{% endif %}>Street Name</option>
        </select>
      </div>
    </div>

    <div class="mt-4 text-right">
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Apply</button>
    </div>
  </form>

  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for prop in properties %}
      <a href="{% url 'property-detail' prop.id %}" class="block bg-white rounded-lg overflow-hidden shadow hover:shadow-lg transition">
        {% with prop.images.all.0 as first_image %}
          {% if first_image %}
            <img src="{{ first_image.url }}" alt="Property Image" class="w-full h-48 object-cover" />
          {% else %}
            <img src="{% static 'images/default.png' %}" alt="No Image" class="w-full h-48 object-cover" />
          {% endif %}
        {% endwith %}
        <div class="p-4">
          <h3 class="text-lg font-semibold">{{ prop.street }} {{ prop.house_number }}</h3>
          <p class="text-sm text-gray-600">{{ prop.city }} {{ prop.postal_code }}</p>
          <p class="text-blue-600 font-bold">{{ prop.listing_price|floatformat:0 }} ISK</p>
        </div>
      </a>
    {% endfor %}
  </div>
</div>
{% endblock %}
